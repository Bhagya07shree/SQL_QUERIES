 USE AMAZON;
 --JOINS

 -- 1. CROSSS JOIN:

 /* 1Q.WQTD CARTESION PRODUCT FROM EMP AND DEPT TABLE ?*/

 SELECT * FROM EMP
 CROSS JOIN DEPT;

-------------------------------------------------------------

-- 1. INNER JOIN:

-------------------------------------------------------------

--1Q.WQTD DETAILS FROM EMP AND DEPT TABLES?

SELECT * FROM EMP AS E
INNER JOIN DEPT AS D
ON E.DNO = D.DNO;

SELECT * FROM EMP
SELECT * FROM DEPT;

--2Q.WQTD EMP FNAME,JOB,SAL, ALONG WITH DEPT NAME IF THE EMP IS 
--GETTING SALARY MORE THEN 45000?

SELECT 
	E.FNAME,E.JOB,E.SAL,
	D.DNAME
FROM EMP AS E
INNER JOIN DEPT D
ON E.DNO = D.DNO
WHERE E.SAL > 45000

--3Q.WQTD CUSTOMER FNAME ALONG WITH HIS LOCATION AND CITY?

SELECT * FROM CUSTOMER
SELECT * FROM LOCATION;

SELECT 
	C.FIRST_NAME,
	L.LOCATION,
	L.CITY
FROM CUSTOMER AS C
INNER JOIN LOCATION AS L
ON C.LID = L.LID

-- 4Q.WQTD EMP FNAME.LNAME WHO ARE ACTING AS DELIVORY BOY?
SELECT * FROM EMP
SELECT * FROM ORDERS;

SELECT 
	E.FNAME,E.LNAME
FROM EMP E INNER JOIN ORDERS O
ON E.EID=O.EID;

--1Q.WQTD EMP FNAME,LNAME,JOB ALONG WITH HIS 
--DNAME IF THE EMPS ARE WORKING AS SALES MAN OR MANAGER.

SELECT * FROM EMP
SELECT * FROM DEPT;

SELECT
	E.FNAME,E.LNAME,E.JOB,
	D.DNAME
FROM EMP AS E
INNER JOIN DEPT AS D
ON E.DNO = D.DNO
WHERE E.JOB IN ('SALESMAN','MANAGER');

-- 2Q.WQTD EMP FNAME,LNAME,DNAME IF THE EMP IS WORKING IN HR DEPT.

SELECT 
	E.FNAME,E.LNAME,
	D.DNAME
FROM EMP AS E
INNER JOIN DEPT AS D
ON E.DNO = D.DNO
WHERE D.DNAME = 'HR';

-- 3Q. WQTD DETAILS OF THE EMPS ALONG WITH THEIR DNAME 
--IF THE EMP BORN AFTER 1995.

SELECT E.*, D.DNAME
FROM EMP AS E
INNER JOIN DEPT AS D
ON E.DNO = D.DNO
WHERE YEAR(E.DOB) > 1995; -- OR WHERE E.DOB > '1995-12-31'

/*4Q. WQTD EMP FNAME,LNAME,JOB AND DNO ALONG WITH THEIR DNAME 
AND DEPT LID IF THE EMP IS WORKING AS SALESMAN,MANAGER OR DEVELOPER IN DNO 110,111 OR 112 
AND HIS FNAME 3RD CHARACTER IS 'H'.*/

SELECT * FROM EMP
SELECT * FROM DEPT;

SELECT 
	E.FNAME,E.LNAME,E.JOB,
	D.DNAME,D.LID
FROM EMP AS E
INNER JOIN DEPT AS D
ON E.DNO = D.DNO
WHERE E.JOB IN ('SALESPERSON','MANAGER','DEVELOPER') 
AND D.DNO IN (110,111,112)
AND E.FNAME LIKE ('--H%');  --OR SUNSTR(E.FNAME,3,1) = 'H';

/* 5Q. WQTD FNAME AND PSW ,THE PSW MUST CONTAIN BELOW CONDITIONS:
1.FIRST 3 CHARACT9ERS OF FNAME 
2.HIS DEPT LID 
3.HIS YOB
*/

SELECT * FROM EMP
SELECT * FROM DEPT
SELECT * FROM LOCATION;

SELECT
	E.FNAME,
	CONCAT(LEFT(E.FNAME,3),D.LID,YEAR(E.DOB)) AS PASSWORD
FROM EMP AS E
INNER JOIN  DEPT AS D
ON E.DNO = D.DNO;

-- 6Q. WQTD EMP FNAME,DNAME AND HIS DEPT LOCATION.
SELECT * FROM EMP
SELECT * FROM DEPT
SELECT * FROM LOCATION;

SELECT 
	E.FNAME,
	D.DNAME,
	L.LOCATION
FROM EMP AS E
INNER JOIN DEPT AS D
ON E.DNO = D.DNO
INNER JOIN LOCATION AS L
ON L.LID = D.LID;

--7Q. WQTD CUSTOMER FIRST_NAME,ORDER_ID, DELIVERY DATE ,PRICE AS TOTAL BILL,
--LOCATION,CITY AND STATE IF THE CUSTOMERS ORDERED SOME PRODUCT.

SELECT * FROM CUSTOMER
SELECT * FROM ORDERS
SELECT * FROM PRODUCT
SELECT * FROM LOCATION;

SELECT 
	C.FIRST_NAME, C.ORDER_ID,
	O.DELIVERY_DATE,
	P.PRICE AS TOTAL_BILL,
	L.LOCATION,L.CITY,L.STATE
FROM CUSTOMER AS C
INNER JOIN ORDERS AS O
ON C.ORDER_ID = O.ORDER_ID
INNER JOIN LOCATION AS L
ON C.LID = L.LID
INNER JOIN PRODUCT AS P
ON O.PRODUCT_ID = P.PRODUCT_ID
WHERE C.ORDER_ID IS NOT NULL;

-- 8Q.WQTD REVENUE GENERATED BY EACH STATE.

SELECT * FROM CUSTOMER
SELECT * FROM PRODUCT
SELECT * FROM LOCATION;

SELECT 
	SUM(P.PRICE) AS REVENUE,
	L.STATE
FROM CUSTOMER AS C
INNER JOIN PRODUCT AS P
ON C.PRODUCT_ID = P.PRODUCT_ID
INNER JOIN LOCATION AS L
ON C.LID = L.LID
GROUP BY L.STATE;

-- 9Q.WQTD TOP 2 CUSTOMERS FNAME ALONG WITH THEIR SPENT MONEY.


SELECT * FROM CUSTOMER
SELECT * FROM PRODUCT

SELECT TOP 2
	C.FIRST_NAME,
	SUM(P.PRICE) AS SPENT_MONEY
FROM CUSTOMER AS C
INNER JOIN PRODUCT AS P
ON C.PRODUCT_ID = P.PRODUCT_ID
GROUP BY C.FIRST_NAME
ORDER BY SPENT_MONEY DESC;

-- 10Q.WQTD MONTH WISE REVENUE GENERATED IN THE YEAR 2022?
SELECT * FROM ORDERS 
SELECT * FROM PRODUCT;

SELECT 
	SUM(P.PRICE) AS REVENUE,
	MONTH(O.ORDER_DATE) AS MONTH_WISE_ORDERS
FROM ORDERS AS O 
INNER JOIN PRODUCT AS P
ON O.PRODUCT_ID = P.PRODUCT_ID
WHERE YEAR(O.ORDER_DATE) = 2022
GROUP BY MONTH(O.ORDER_DATE);

-- 11Q.WQTD EMP AND HID MANAGER DETAILS FROM EMP TABLE?
-- (FROM E1(WHICH WE CONSIDERED AS EMP DETAILS) WE HAVE TO SELECT MGR,E2(WHICH WE CONSIDERED AS MGR DETAILS)WE HAVE TO SELECT EID)

SELECT * FROM EMP

SELECT *
FROM EMP AS E1 
JOIN EMP AS E2
ON E1.MGR = E2.EID;

-- 12Q. WQTD EMP FNAME,SAL ALONG WITH THEIR MANAGER FNAME,SAL 
-- IF THE EMP IS GETTING SALARY MORE THEN 35000 AND MANAGER IS GETTING SAL<500000?

SELECT * FROM EMP

SELECT 
	E1.FNAME AS EMP_NAME,
	E1.SAL AS EMP_SAL,
	E2.FNAME AS MGR_NAME,
	E2.SAL AS MGR_SAL
FROM EMP E1
INNER JOIN EMP E2
ON E1.MGR = E2.EID
WHERE E1.SAL > 35000 AND E2.SAL < 500000;

-- 13Q.WQTD EMP FNAME,DOB ALONG WITH MGR FNAME,DOB 
-- IF EMP IS ELDER THEN HIS MANAGER?

SELECT * FROM EMP

SELECT 
	E1.FNAME AS EMPPLOYEE_NAME,
	E1.DOB AS EMP_DOB,
	E2.FNAME AS MGR_NAME,
	E2.DOB AS MGR_DOB
FROM EMP E1
JOIN EMP E2
-- ON E1.EID = E2.MGR -- WRONG
ON E1.MGR = E2.EID
WHERE E1.DOB < E2.DOB;

-- 14Q.WQTD EMP FNAME,MGR FNAME ALONG WITH MANAGER DEPT NAME?
SELECT * FROM EMP
SELECT * FROM DEPT;

SELECT
	E1.FNAME AS EMPLOYEE_NAME,
	E2.FNAME AS MGR_NAME,
	D2.DNAME AS MGR_DEPT_NAME
FROM EMP  AS E1
JOIN EMP  AS E2
ON E1.MGR = E2.EID
JOIN DEPT D2
ON E2.DNO = D2.DNO;


-- 15Q.WQTD EMP FNAME,JOB,MGR FNAME,JOB, ALONG WITH THEIR DEPT NAME 
-- IF EMP IS WORKING AS MANAGER OR SALESMAN AND 
-- EMP DEPT NAME IS EITHER MARKETTING OR DELIVERY AND MANAGER IS WORKING AS MANAGER?

SELECT * FROM EMP
SELECT * FROM DEPT;

SELECT 
	E1.FNAME AS EMP_NAME,
	E1.JOB AS EMP_JOB,
	D1.DNAME AS EMP_DEPT,
	E2.FNAME AS  MGR_NAME,
	E2.JOB AS  MGR_JOB,
	D2.DNAME AS MGR_DPT
FROM EMP E1
JOIN EMP E2
ON E1.MGR = E2.EID 
INNER JOIN DEPT D1
ON E1.DNO = D1.DNO
INNER JOIN DEPT D2
ON E2.DNO = D2.DNO
WHERE 
	E1.JOB IN ('MANAGER','SALESMAN') AND
	D1.DNAME IN('MARKETING','DELIVERY') AND
	E2.JOB = 'MANAGER';

-- 6Q.WQTD EMP FNAME,DNAME,AND DEPT LOCATION ALONG 
-- WITH MGR FNAME,DNAME,AND DEPT LOCATION?

SELECT * FROM EMP
SELECT * FROM DEPT
SELECT * FROM LOCATION;

SELECT
	E1.FNAME AS EMP_NAME,
	D1.DNAME AS EMP_DEPT_NAME,
	L1.LOCATION AS EMP_LOCATION,
	E2.FNAME AS MGR_NAME,
	D2.DNAME AS MGR_DEPT_NAME,
	L2.LOCATION AS MGR_LOCATION
FROM EMP AS E1
JOIN EMP AS E2
ON E1.MGR = E2.EID
INNER JOIN DEPT AS D1
ON E1.DNO = D1.DNO
INNER JOIN DEPT AS D2
ON E2.DNO = D2.DNO
INNER JOIN LOCATION AS L1
ON D1.LID = L1.LID
INNER JOIN LOCATION AS L2
ON D2.LID = L2.LID

------------- 0R ------------

--   Optimized + Readable 

SELECT
    E1.FNAME AS EMP_NAME,
    D1.DNAME AS EMP_DEPT_NAME,
    L1.LOCATION AS EMP_LOCATION,
    E2.FNAME AS MGR_NAME,
    D2.DNAME AS MGR_DEPT_NAME,
    L2.LOCATION AS MGR_LOCATION
FROM EMP AS E1
INNER JOIN EMP AS E2 ON E1.MGR = E2.EID
INNER JOIN DEPT AS D1 ON E1.DNO = D1.DNO
INNER JOIN DEPT AS D2 ON E2.DNO = D2.DNO
INNER JOIN LOCATION AS L1 ON D1.LID = L1.LID
INNER JOIN LOCATION AS L2 ON D2.LID = L2.LID
ORDER BY E1.FNAME;

--- 7Q.WQTD DNAME OF MURALI'S MGR?

SELECT * FROM EMP
SELECT * FROM DEPT;

SELECT 
	E1.FNAME AS EMP_NAME,
	E2.FNAME AS MGR_NAME,
	D2.DNAME AS MGR_DEPT_NAME
FROM EMP E1 
JOIN EMP E2
ON  E1.MGR = E2.EID
INNER JOIN DEPT AS D2
ON E2.DNO = D2.DNO
WHERE  E1.FNAME ='MURALI' 

-------------------------------------------------------------

-- 2. LEFT OUTER JOIN:

-------------------------------------------------------------

/* 1Q.WQTD MATCHED AND UNMACHED RECORED FROM EMP TABLE AND 
CONSIDER EMP AS LEFT TABLE AND DEPT AS RIGHT TABLE? */

SELECT * FROM EMP
SELECT * FROM DEPT

SELECT * FROM EMP AS E
LEFT JOIN DEPT  AS D
ON E.DNO = D.DNO;

-- 2Q.WQTD MATCHED AND UNMACHED RECORED FROM EMP TABLE AND CONSIDER EMP AS RIGHT TABLE 
-- AND DEPT AS LEFT TABLE ?

SELECT * FROM EMP
SELECT * FROM DEPT;

SELECT * FROM DEPT AS D 
LEFT JOIN EMP AS E 
ON E.DNO = D.DNO;

------ 0R-----

SELECT * FROM EMP AS E
RIGHT JOIN DEPT AS D
ON E.DNO = D.DNO;

-- 3Q.WQTD LOCATION WHERE NO CUSTOMER ARE LIVING?
-- (LOCATION TABLE AS PREORITY BECAUSE LID IS PRIMARY KEY IN LOCATION TABLE)

SELECT * FROM LOCATION
SELECT * FROM CUSTOMER;

SELECT 
	L.LOCATION
FROM LOCATION AS L
LEFT JOIN CUSTOMER  AS C
ON L.LID = C.LID
WHERE C.CID IS NULL;

-- 4Q.WQTD DETAILS OF PRODUCT WHICH ARE NOT ORDERED BY CUSTOMER?

SELECT * FROM CUSTOMER
SELECT * FROM ORDERS
SELECT * FROM PRODUCT;

SELECT P.*
FROM PRODUCT P
LEFT JOIN CUSTOMER C
ON P.PRODUCT_ID = C.PRODUCT_ID
WHERE C.CID IS NULL;

------- 0R --------

SELECT P.*
FROM PRODUCT P
LEFT JOIN ORDERS O
ON P.PRODUCT_ID = O.PRODUCT_ID
WHERE O.ORDER_ID IS NULL;

-- 5Q.WQTD DETAILS OF LOCATION NO DEPT IS LOCATED?
SELECT * FROM LOCATION
SELECT * FROM DEPT

SELECT L.*
FROM LOCATION L
LEFT JOIN DEPT AS D
ON L.LID = D.LID
WHERE D.DNO IS NULL

-----------------------------------------------------------
-----------------------------------------------------------

-- 1Q.WQTD NUMBER OF CUSTOMER LIVING IN HYDERABAD CITY?

SELECT * FROM CUSTOMER
SELECT * FROM LOCATION;

SELECT
	COUNT(*) AS NO_OF_CUSTOMERS
FROM CUSTOMER AS C
INNER JOIN LOCATION L
ON C.LID = L.LID
WHERE L.CITY = 'HYDERABAD';

-- 2Q. WQTD FNAME OF AMAN'S MANAGER MANAGER?
-- (E1=AMAN,E2=AMAN'S MANAGER,E3=AMAN'S MANAGER'S MANAGER)

SELECT * FROM EMP;

SELECT
	E1.FNAME AS EMP_NAME,
	E2.FNAME AS EMP_MANAGER,
	E3.FNAME AS EMP_MANAGERS_MANAGER
FROM EMP AS E1
JOIN EMP AS E2
ON E1.MGR = E2.EID
JOIN EMP AS E3
ON E2.MGR = E3.EID 
WHERE E1.FNAME = 'AMAN'

-- 3Q.WQTD DEPT NAME OF EMPS WHO ARE REPORTING TO RAHUL?

SELECT * FROM EMP
SELECT * FROM DEPT

SELECT
	E1.FNAME AS EMP_NAME,
	E2.FNAME AS MANAGER_NAME,
	D1.DNAME AS _DEPT_NAME_OF_EMPLOYEE
FROM EMP AS E1
JOIN EMP AS E2
ON E1.MGR = E2.EID
INNER JOIN DEPT AS D1
ON E1.DNO = D1.DNO
WHERE E2.FNAME ='RAHUL';

-- 4Q.WQTD WORKING CITY OF EMPS WHO ARE GETTING 3RD MAX SALARY?


SELECT * FROM DEPT
SELECT * FROM EMP
SELECT * FROM LOCATION

SELECT
	E.FNAME AS EMP_NAME,
	E.SAL AS EMP_SALARY,
	L.CITY AS WORKING_CITY

FROM EMP AS E
INNER JOIN DEPT AS D
ON E.DNO = D.DNO
INNER JOIN LOCATION AS L
ON D.LID = L.LID
WHERE E.SAL = (SELECT MIN(EMP_SAL)
    FROM (
        SELECT DISTINCT TOP 3 E1.SAL AS EMP_SAL
        FROM EMP AS E1 
        ORDER BY E1.SAL DESC
    ) AS TOP_3_SAL
);
  ---------- CHAT GPT----------  
SELECT
    E.FNAME AS EMP_NAME,
    E.SAL AS EMP_SALARY,
    L.CITY AS WORKING_CITY
FROM EMP AS E
INNER JOIN DEPT AS D ON E.DNO = D.DNO
INNER JOIN LOCATION AS L ON D.LID = L.LID
WHERE E.SAL = (
    SELECT MIN(sal_val)
    FROM (
        SELECT DISTINCT TOP 3 E2.SAL AS sal_val
        FROM EMP AS E2
        ORDER BY E2.SAL DESC
    ) AS TopSalaries
);

------------- USING SELF JOIN ---------------


-- 5Q.WQTD DETAILS OF EMPS WHO ARE GETTING SAL MORE THAN KARAN?
-- *NOTE : WE CAN PROVE HERE,SELF JOIN IS NOT ONLY FOR EMP AND MANAGER RELATIONSHIP ITS FOR IF INPUT AND OUTPUT IS IN SAME TABLE.

SELECT * FROM EMP

SELECT 
	E1.FNAME AS NAME,
	E1.SAL AS SALARY
FROM EMP E1 JOIN EMP E2
ON E1.SAL>E2.SAL
WHERE E2.FNAME='KARAN';


--- 6Q.WQTD SECOND MAX SAL FROM EMP TABLE?

SELECT * FROM EMP;

SELECT
	E1.FNAME AS EMP_NAME,
	E1.SAL AS EMP_SAL
FROM EMP AS E1
WHERE E1.SAL = (
	SELECT MIN(SAL_VAL)
		FROM(
			SELECT DISTINCT TOP 2 E2.SAL AS SAL_VAL
				FROM EMP E2
				ORDER BY E2.SAL DESC) AS TOP_2_SAL
				);



-- 7Q.WQTD 3RD MIN SAL FROM EMP?

SELECT DISTINCT SAL FROM EMP
ORDER BY SAL;

SELECT
	E1.FNAME AS EMP_NAME,
	E1.SAL AS EMP_SAL
FROM EMP AS E1
WHERE E1.SAL = (
	SELECT  MAX(SAL_VAL)
	FROM( SELECT DISTINCT TOP 3 E2.SAL AS SAL_VAL
			FROM EMP AS E2
			ORDER BY E2.SAL ASC) AS TOP_3RD_MIN_SAL
			);


-- 8Q.WQTD 5TH MAX SAL FROM EMP?

SELECT DISTINCT SAL FROM EMP 
ORDER BY SAL DESC;

SELECT 
	E1.FNAME AS EMP_NAME,
	E1.SAL AS EMP_SAL
FROM EMP AS E1
WHERE E1.SAL = (
		SELECT MIN(SAL_VAL)
		FROM (SELECT DISTINCT TOP 5 E2.SAL AS SAL_VAL
				FROM EMP E2
				ORDER BY E2.SAL DESC) AS TOP_5TH_MAX_SAL
				);


-- 9Q.WQTD DETAILS OF EMPS WHO ARE REPORTING TO RAHUL 
-- IF RAHUL IS GETTING SAL MORETHEN KIRAN?

SELECT 
	E1.*,
	E2.FNAME AS MANAGER_NAME
FROM EMP AS E1
JOIN EMP AS E2
ON E1.MGR = E2.EID
WHERE E2.FNAME = 'RAHUL' AND 
E2.SAL > ( SELECT SAL FROM EMP WHERE FNAME = 'KIRAN');

------------- UNION, UNION ALL ------------ 